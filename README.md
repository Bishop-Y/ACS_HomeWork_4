# ACS_HomeWork_4 <br/> Работу выполнил Епифанов Артём, группа БПИ 217, Вариант 7 (на 8 баллов)
# Многопоточное приложение на C++ с использованием pthread и mutex (двоичный семафор).
## Условие задачи
Задача о курильщиках. Есть три процесса-курильщика и один процесс-посредник. Курильщик непрерывно скручивает сигареты и курит их. Чтобы скрутить сигарету, нужны табак, бумага и спички. У одного процесса-курильщика есть табак, у второго – бумага, а у третьего – спички. Посредник кладет на стол по два разных случайных компонента. Тот процесс-курильщик, у которого есть третий компонент, забирает компоненты со стола, скручивает сигарету и курит. Посредник дожидается, пока курильщик закончит, затем процесс повторяется. Создать многопоточное приложение, моделирующее поведение курильщиков и посредника. При решении задачи использовать семафоры. <br/> <br/>

# На 4 балла:
### Приведено решение задачи на C++ с комментаряими: <br/>
> * [Программа на C++ с комментариями](https://github.com/Bishop-Y/ACS_HomeWork_4/blob/main/main.cpp) <br/>
### Модель вычислений:
В моей программе 4 потока: брокеров, у которого есть определённое количество ингридиентов, и 3 курильщика, у каждого из которых есть бесконечное количество определённого ингридиента. Все потоки работают параллельного до того момента, пока не определяется с помощью моего флага who_print кто из них должен отработать. По сути получилось так, что я распараллелил if. Все потоки работают, пока у брокера есть нужное количество ингридиентов для того, чтобы можно было свернуть хотя бы одну сигарету для любого курильщика. Сначала у брокера срабатывает мьютекс, который останавливает курильщиков. Рандомно выбираются 2 РАЗНЫХ ингридиента и затем по ним определяется, кто именно из курильщиков должен начать крутить. Затем в брокере мьютекс снимает лок и срабатывают паралелльно в каждом потоке-курильщике if. В нужном курильщике так же срабатывает мьютекс, он берёт ингридиенты у брокера, скручивает сигарету и курит её. Все остальные ждут. Курильщик докурил, и процесс повторяется, пока есть нужное количество ингридиентов у брокера. <br/>
Можно увеличивать до бесконечности (ну точнее до количества ядер в процессоре)) количество типов ингридиентов у брокера и количество курильщиков с каждым уникальным типом ингридиента. Брокер всегда будет класть n-1 разных ингридиентов на стол, где n - количество курильщиков. <br/>
### Входные данные программы и вариативные диапазоны:
> * Чтобы использовать ввод без командной строки, не вводите дополнительные аргументы при запуске программы и следуйте инструкциям в консоли. Вся работа программы выведется в консоль.
> * Чтобы использовать ввод с файла и вывод в файл, надо использовать командную строку и прописать в ней имя файла с входными данными, и имя файла, куда нужно сохранить результат (пример ввода "./file.exe input.txt output.txt"). Также вся работа программы выведется и в консоль. Диапазон каждого ингридиента 0 <= n <= 10.
> * Чтобы использовать рандомную генерацию данных, введите в командной строке только одно число (seed) (пример ввода "./file.exe 5"). Вся работа программы выведется в консоль. Диапазон каждого ингридиента 0 <= n <= 10.
> * Чтобы ввести количество ингридиентов в командной строке, последовательно через пробел 3 числа (от 0 до 10 включительно) - количество табака, бумаги и спичек (пример ввода "./file.exe 2 8 4"). Вся работа программы выведется в консоль. <br/> <br/>

# На 5 баллов:
### Приведено решение задачи на C++ с комментаряими: <br/>
> * [Программа на C++ с комментариями](https://github.com/Bishop-Y/ACS_HomeWork_4/blob/main/main.cpp) <br/>
### Сценарий: <br/>
> 1. Есть брокер и 3 курильщика.
> 2. Курильщики ждут, пока брокер выберет 2 РАЗНЫХ ингридиента и положит на стол.
> 3. Допустим, что брокер положил бумагу и спички. Тогда курильщик с табаком забирает ингридиенты со стола, скурчивает сигарету и курит её. Брокер и 2 других курильщика ждут, пока он докурит.
> 4. Курильщик докурил, и процесс повторяется (брокер начинает выбирать ингридиенты). <br/>

Получатеся, что курить может одновременно только один курильщик. 2 курилщьика и брокер ждут, когда он докурит. Затем все курильщики ждут, какие ингридиенты выложит брокер (пока они у него есть). <br/>

# На 6 баллов:
### Реализован ввод данных из командной строки - да. <br/>
### Обобщённый алгоритм: <br/>

Инициализируется мьютекс ```busy```. <br/>

Функция ```broker_working``` отвечает за логику брокера (выбор ингридиентов, которые кладутся на стол). <br/>

Функция ```tobacco_smoker``` отвечает за логику курильщика с табаком. (Берёт со стола бумагу и спички, скуричивает и курит сигарету) <br/>

Функция ```paper_smoker``` отвечает за логику курильщика с бумагой. (Берёт со стола табак и спички, скуричивает и курит сигарету) <br/>

Функция ```match_smoker``` отвечает за логику курильщика со спичками. (Берёт со стола табак и бумагу, скуричивает и курит сигарету) <br/>

Брокеру выдаётся определённое количество трёх типов ингридиента (табака, бумаги и спичек). Каждый ингридиент на входе может принимать значения от 0 до 10 включительно. <br/>

Инициализиурется мьютекс, который будет давать выполнить свою работу одному из четырёх потоков в зависимости от ситуации. <br/>

Брокер останавливает трёх курильщиков, выбириает и кладёт ингридиенты на стол. Затем "разблокирует" курильщиков. <br/>

Затем один из курильщиков останавливает брокера и двух курильщиков, скручивает и курит сигарету, затем разблокирует остальных и процесс повторяется до тех пор, пока у брокера есть нужное количество ингридиентов. <br/>

В конце программы мьютекс ```busy``` уничтожается. <br/>

# На 7 баллов:
### В программу добавлены ввод данных из файла и вывод результатов в файл и результаты дублируются на экран - да. <br/>
### Приведены входные и выходные файлы с различными результатами выполнения программы: <br/>
> * [Тесты](https://github.com/Bishop-Y/ACS_HomeWork_4/tree/main/tests) <br/>

# На 8 баллов:
### В программу добавлен генератор случайных данных в допустимых диапазонах - да. <br/>
### Приведены входные и выходные данные с рандомной генерацией данных: <br/>
<img width="569" alt="image" src="https://user-images.githubusercontent.com/66753948/207401111-740d3dad-0e3f-4982-955f-a7cc059d8c43.png">

